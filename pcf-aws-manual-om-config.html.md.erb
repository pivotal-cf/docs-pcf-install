---
title: Configuring Ops Manager Director on AWS
owner: Ops Manager
---

<strong><%= modified_date %></strong>
<html class="list-style-none"></html>

This topic describes how to configure Ops Manager to deploy Pivotal Cloud Foundry (PCF) on Amazon Web Services (AWS).

Before beginning this procedure, ensure that you have successfully completed all of the steps in the [Installing PCF on AWS Manually](pcf-aws-manual-config.html) topic. After completing the procedures in this topic, proceed to the [Deploying PAS on AWS](pcf-aws-manual-er-config.html) topic to continue deploying PCF.

## <a id='pcfaws-om-access'></a>Step 1: Access Ops Manager

<p class="note"><strong>Note</strong>: For security, Ops Manager v1.7 and later require that you log in using a fully qualified domain name to access Ops Manager.</a></p>

1. In a web browser, navigate to the fully qualified domain you created in the [Configure DNS Records](./pcf-aws-manual-config.html#pcfaws-dns) step of _Installing PCF on AWS Manually_.

1. When Ops Manager starts for the first time, you must choose one of the following:
    * <strong>[Use an Identity Provider](#idp)</strong>: If you use an Identity Provider, an external identity server maintains your user database.
    * <strong>[Internal Authentication](#internal)</strong>: If you use Internal Authentication, PCF maintains your user database.

<%= image_tag("select-authentication.png") %>

### <a id='idp'></a>Use an Identity Provider (IdP) ###

<%= partial 'using_idp_ops_manager' %> 

### <a id='internal'></a>Internal Authentication ###

1.  When redirected to the **Internal Authentication** page, you must complete the following steps:
    * Enter a **Username**, **Password**, and **Password confirmation** to create an Admin user.
    * Enter a **Decryption passphrase** and the **Decryption passphrase confirmation**. This passphrase encrypts the Ops Manager datastore, and is not recoverable.
    * If you are using an **HTTP proxy** or **HTTPS proxy**, follow the instructions in the [Configuring Proxy Settings for the BOSH CPI](./pcf-director-proxy-settings.html) topic.
    * Read the **End User License Agreement**, and select the checkbox to accept the terms.
    * Click **Setup Authentication**.

    <%= image_tag("om-login.png") %>

1. Log in to Ops Manager with the Admin username and password you created in the previous step.

    <%= image_tag("cf-login.png") %>

## <a id='pcfaws-om-awsconfig'></a>Step 2: AWS Config Page ##

1. Click the **Ops Manager Director** tile.

    <%= image_tag("cloudform/om-tile.png") %>

1. Select **AWS Config**.

    <%= image_tag("cloudform/aws-config.png") %>

1. Select **Use AWS Keys** or **Use AWS Instance Profile**.
    * **Access Key ID** and **AWS Secret Key**: To retrieve your AWS key information, use the AWS Identity and Access Management (IAM) credentials that you generated in the [Step 3: Create an IAM User for PCF](pcf-aws-manual-config.html#create-iam) section of the _Installing PCF on AWS Manually_ topic.
    * **AWS IAM Instance Profile**: Enter the name of the IAM profile you created in the [Step 3: Create an IAM User for PCF](pcf-aws-manual-config.html#create-iam) section of the _Installing PCF on AWS Manually_ topic. 

1. Complete the rest of the **AWS Management Console Config** page:
    * **VPC ID**: Enter your PCF VPC ID. Locate the VPC ID on the AWS VPC Dashboard page next to the VPC name.
    * **Security Group ID**: Enter the **Group ID** of the `pcf-vms-security-group` you created for your PCF VMs in the [Step 6: Configure a Security Group for PCF VMs](pcf-aws-manual-config.html#pcfaws-om-ersecgrp) section of the _Installing PCF on AWS Manually_ topic. Locate the Group ID in the **Security Groups** tab of your EC2 Dashboard.
    * **Key Pair Name**: Enter `pcf-ops-manager-key`.
    * **SSH Private Key**: Open the AWS key pair `pcf-ops-manager-keys.pem` file you generated in the [Step 3: Create an IAM User for PCF](pcf-aws-manual-config.html#create-iam) section of the _Installing PCF on AWS Manually_ topic. Copy the contents of the `.pem` file and paste it into the **SSH Private Key** field.
    * **Region**: Select the region where you deployed Ops Manager.
    * **Encrypt EBS Volumes**: Select this checkbox to enable full encryption on persistent disks of all BOSH-deployed VMs except the Ops Manager VM and Director VM. See the [Configuring Amazon EBS Encryption for PCF on AWS](cloudform-om-ebs-config.html) topic for details about using EBS encryption.
    <p class="note warning"><strong>WARNING:</strong> Do not enable EBS encryption if you are running <strong>PAS for Windows</strong> or <strong>PAS for Windows 2012R2</strong>. EBS encryption is currently incompatible with Windows VMs and it prevents Windows runtimes from installing.</p>

1. Click **Save**.

## <a id='pcfaws-om-dirconfig'></a>Step 3: Director Config Page ##

1. Select **Director Config**.

    <%= image_tag("images/cloudform/director_aws.png") %>

1. Enter at least two of the following NTP servers in the **NTP Servers (comma delimited)** field, separated by a comma: `0.amazon.pool.ntp.org,1.amazon.pool.ntp.org,2.amazon.pool.ntp.org,3.amazon.pool.ntp.org`

1. Leave the **JMX Provider IP Address** field blank.
  <p class="note"><strong>Note</strong>: Starting from PCF v2.0, BOSH-reported component metrics are available in the Loggregator Firehose by default. Therefore, if you continue to use PCF JMX Bridge for consuming them outside of the Firehose, you may receive duplicate data. To prevent this, leave the <strong>JMX Provider IP Address</strong> field blank. For additional guidance, see <a href="http://docs.pivotal.io/pivotalcf/2-0/pcf-release-notes/runtime-rn.html#bosh-metrics">BOSH System Metrics Available in Loggregator Firehose</a>.</p>

1. Leave the **Bosh HM Forwarder IP Address** field blank.
  <p class="note"><strong>Note</strong>: Starting from PCF v2.0, BOSH-reported component metrics are available in the Loggregator Firehose by default. Therefore, if you continue to use the BOSH HM Forwarder for consuming them, you may receive duplicate data. To prevent this, leave the <strong>Bosh HM Forwarder IP Address</strong> field blank. For additional guidance, see <a href="http://docs.pivotal.io/pivotalcf/2-0/pcf-release-notes/runtime-rn.html#bosh-metrics">BOSH System Metrics Available in Loggregator Firehose</a>.</p>

1. Select the **Enable VM Resurrector Plugin** checkbox to enable the Ops Manager Resurrector functionality and increase Pivotal Application Service (PAS) availability. For more information, see the [Using Ops Manager Resurrector on VMware vSphere](./resurrector.html) topic.

1. Select **Enable Post Deploy Scripts** to run a post-deploy script after deployment. This script allows the job to execute additional commands against a deployment.

1. Select **Recreate all VMs** to force BOSH to recreate all VMs on the next deploy. This process does not destroy any persistent disk data.

1. Select **Enable bosh deploy retries** if you want Ops Manager to retry failed BOSH operations up to five times.

1. Select **Keep Unreachable Director VMs** if you want to preserve Ops Manager Director VMs after a failed deployment for troubleshooting purposes. 

1. (Optional) Select **HM Pager Duty Plugin** to enable Health Monitor integration with PagerDuty.

    <%= image_tag("images/director_hm_pager.png") %>
    * **Service Key**: Enter your API service key from PagerDuty.
    * **HTTP Proxy**: Enter an HTTP proxy for use with PagerDuty.

1. (Optional) Select **HM Email Plugin** to enable Health Monitor integration with email.

    <%= image_tag("images/director_hm_email.png") %>
    * **Host**: Enter your email hostname.
    * **Port**: Enter your email port number.
    * **Domain**: Enter your domain.
    * **From**: Enter the address for the sender.
    * **Recipients**: Enter comma separated addresses of intended recipients.
    * **Username**: Enter the username for your email server.
    * **Password**: Enter your username's password.
    * **Enable TLS**: Select this checkbox to enable Transport Layer Security.

1. For **Blobstore Location**, select **S3 Compatible Blobstore** and complete the following steps:

    <%= image_tag("images/director_blobstore.png") %>
    * **S3 Endpoint**: Navigate to the [Regions and Endpoints](http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region) topic in the AWS documentation. Locate the endpoint for your region in the **Amazon Simple Storage Service (S3)** table and construct a URL using your region's endpoint. For example, if you are using the `us-west-2` region, the URL you create would be `https://s3-us-west-2.amazonaws.com`. Enter this URL into the **S3 Endpoint** field in Ops Manager.
    * **Bucket Name**: Enter the Ops Manager bucket name that you defined in
    the [Manually Configuring PCF for AWS](./pcf-aws-manual-config.html#pcfaws-s3) topic.
    * **Access Key** and **Secret Key**: To retrieve your AWS key information, use the IAM credentials that you generated in the [Manually Configuring AWS for PCF](./pcf-aws-manual-config.html#pcfaws-iam-user) topic.
    * Select **V2 Signature** or **V4 Signature**. If you select **V4 Signature**, enter your **Region**.
      <p class="note"><strong>Note</strong>: AWS recommends using Signature Version 4. For more information about AWS S3 Signatures, see the <a href="http://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-authenticating-requests.html">Authenticating Requests</a> documentation.</p>

1. For **Database Location**, select **External MySQL Database** and complete the following steps:
    <%= image_tag("images/director_database.png") %>
    * From the AWS Console, navigate to the RDS Dashboard.
    * Select **Instances**, then click the arrow to the left of your instance and select the second icon to display the **Details** information.
    * Refer to the following table to retrieve the values for the **Director Config** page:
    <table border="1" class="nice" >
      <tr>
        <th><strong>RDS Instance Field </strong></th>
        <th><strong>Ops Manager Director Field </strong></th>
      </tr>
      <tr>
        <td>Endpoint</td>
        <td><strong>Host</strong></td>
      </tr>
      <tr>
        <td>Port</td>
        <td><strong>Port</strong>, which is <code>3306</code>.</td>
      </tr>
      <tr>
        <td>DB Name</td>
        <td><strong>Database</strong>, which is <code>bosh</code>.</td>
      </tr>
      <tr>
        <td>Username</td>
        <td><strong>Username</strong></td>
      </tr>
    </table><br />
    * For **Password**, enter the password that you defined for your MySQL database when you created in the [Step 19: Create a MySQL Database using AWS RDS](pcf-aws-manual-config.html#pcfaws-mysql-rds) section of the _Installing PCF on AWS Manually_ topic.

1. (Optional) **Director Workers** sets the number of workers available to execute Director tasks. This field defaults to 5.
1. (Optional) **Max Threads** sets the maximum number of threads that the BOSH Director can run simultaneously. For AWS, the default value is 6. Leave this field blank to use this default value. Pivotal recommends that you use the default value unless doing so results in rate limiting or errors on your IaaS.
1. (Optional) To add a custom URL for your BOSH Director, enter a valid hostname in **Director Hostname**. You can also use this field to configure [a load balancer in front of your BOSH Director](https://discuss.pivotal.io/hc/en-us/articles/225420588).
1. <%= partial "exclude-recursors" %>
1. (Optional) To disable BOSH DNS, select the **Disable BOSH DNS server for troubleshooting purposes** checkbox. For more information about the BOSH DNS service discovery mechanism, see [BOSH DNS Service Discovery for Application Containers](http://docs.pivotal.io/pivotalcf/2-0/pcf-release-notes/runtime-rn.html#bosh-dns) in the Pivotal Application Service (PAS) Release Notes.
  <p class="note breaking"><strong>Breaking Change</strong>: Do not disable BOSH DNS without consulting Pivotal Support. For more information about disabling BOSH DNS, see <a href="https://discuss.pivotal.io/hc/en-us/articles/115015720428-Disabling-or-Opting-Out-of-BOSH-DNS-in-PCF">Disabling or Opting Out of BOSH DNS in PCF</a> in the Pivotal Knowledge Base.</p>
1. (Optional) To set a custom banner that users see when logging in to the Director using SSH, enter text in the **Custom SSH Banner** field.
  <%= image_tag("disable-bosh-dns.png") %>

1. Click **Save**.

## <a id='az'></a> Step 4: Create Availability Zones Page

<p class="note"><strong>Note:</strong> Pivotal recommends at least three availability zones (AZs) for a highly available installation of PAS. The procedures in <a href="pcf-aws-manual-config.html">Installing PCF on AWS Manually</a> use 3 AZs.</p>

1. Select **Create Availability Zones**.
<%= image_tag("cloudform/create-az.png") %>

1. Perform the following steps to add the three AZs you specified in the [Step 4: Create a VPC](pcf-aws-manual-config.html#pcfaws-vpc) section of the _Installing PCF on AWS Manually_ topic:
    1. Click **Add**.
    1. For **Amazon Availability Zone**, enter the name of the AZ.
    1. Repeat until you have entered all three AZs, in the format `REGION-#a`, `REGION-#b`, and `REGION-#c`. For example, `us-west-2a`, `us-west-2b`, and `us-west-2c`. 

1. Click **Save**.

## <a id='pcfaws-om-networks'></a> Step 5: Create Networks Page

1. Select **Create Networks**.
<%= image_tag("cloudform/create-networks.png") %>
1. (Optional) Select **Enable ICMP checks** to enable ICMP on your networks. Ops Manager uses ICMP checks to confirm that components within your network are reachable.

1. Perform the following steps to add the network configuration you created for your VPC in the [Step 4: Create a VPC](pcf-aws-manual-config.html#pcfaws-vpc) section of the _Installing PCF on AWS Manually_ topic. Record your VPC CIDR if you set a CIDR other than the recommendation.
    1. Click **Add Network**.
    1. For **Name**, enter `pcf-management-network`.
    1. Create a subnet for each availability zone by clicking **Add Subnet**. Refer to the table below for the information required to create all three subnets:
         <table>
         <tr>
           <th>VPC Subnet ID</th>
           <th>CIDR</th>
           <th>Reserved IP Ranges</th>
           <th>DNS</th>
           <th>Gateway</th>
           <th>Availability Zones</th>
         </tr>
         <tr>
           <td>`pcf-management-subnet-az0`</td>
           <td>`10.0.16.0/28`</td>
           <td>`10.0.16.0-10.0.16.4`</td>
           <td style="white-space:nowrap">`10.0.0.2`<strong>\*</strong></td>
           <td>`10.0.16.1`</td>
           <td>`REGION-#a` (for example, `us-west-2a`)</td>
         </tr>
         <tr>
           <td>`pcf-management-subnet-az1`</td>
           <td>`10.0.16.16/28`</td>
           <td>`10.0.16.16-10.0.16.20`</td>
           <td style="white-space:nowrap">`10.0.0.2`<strong>\*</strong></td>
           <td>`10.0.16.17`</td>
           <td>`REGION-#b` (for example, `us-west-2b`)</td>
         </tr>
         <tr>
           <td>`pcf-management-subnet-az2`</td>
           <td>`10.0.16.32/28`</td>
           <td>`10.0.16.32-10.0.16.36`</td>
           <td style="white-space:nowrap">`10.0.0.2`<strong>\*</strong></td>
           <td>`10.0.16.33`</td>
           <td>`REGION-#c` (for example, `us-west-2c`)</td>
         </tr>
         </table>
         <p><strong>\*</strong> If you set a VPC CIDR other than recommended, enter the second IP in your VPC CIDR. For example, for a <code>10.0.0.0/24</code> VPC CIDR, enter <code>10.0.0.2</code> in each subnet.</p>
    <br><br>
    1. Click **Add Network**.
    1. For **Name**, enter `pcf-pas-network`.
    1. Create a subnet for each availability zone by clicking **Add Subnet**. Refer to the table below for the information required to create all three subnets:
         <table>
          <tr>
          <th>VPC Subnet ID</th>
           <th>CIDR</th>
           <th>Reserved IP Ranges</th>
           <th>DNS</th>
           <th>Gateway</th>
           <th>Availability Zones</th>
         </tr>
         <tr>
           <td>`pcf-pas-subnet-az0`</td>
           <td>`10.0.4.0/24`</td>
           <td>`10.0.4.0-10.0.4.4`</td>
           <td style="white-space:nowrap">`10.0.0.2`<strong>\*</strong></td>
           <td>`10.0.4.1`</td>
           <td>`REGION-#a` (for example, `us-west-2a`)</td>
         </tr>
         <tr>
           <td>`pcf-pas-subnet-az1`</td>
           <td>`10.0.5.0/24`</td>
           <td>`10.0.5.0-10.0.5.4`</td>
           <td style="white-space:nowrap">`10.0.0.2`<strong>\*</strong></td>
           <td>`10.0.5.1`</td>
           <td>`REGION-#b` (for example, `us-west-2b`)</td>
         </tr>
         <tr>
           <td>`pcf-pas-subnet-az2`</td>
           <td>`10.0.6.0/24`</td>
           <td>`10.0.6.0-10.0.6.4`</td>
           <td style="white-space:nowrap">`10.0.0.2`<strong>\*</strong></td>
           <td>`10.0.6.1`</td>
           <td>`REGION-#c` (for example, `us-west-2c`)</td>
         </tr>
         </table>
         <p><strong>\*</strong> If you set a VPC CIDR other than recommended, enter the second IP in your VPC CIDR. For example, for a <code>10.0.0.0/24</code> VPC CIDR, enter <code>10.0.0.2</code> in each subnet.</p>
    <br><br>
    1. Click **Add Network**.
    1. Check the **Service Network** box. This allows you to dynamically provision VMs in this network for use with on-demand services. Ops Manager does not provision VMs within the specified CIDR range.
    1. Enter `pcf-services-network` in **Name** field.
    1. Create a subnet for each availability zone by clicking **Add Subnet**. Refer to the table below for the information required to create all three subnets:
          <table>
           <tr>
             <th>VPC Subnet ID</th>
             <th>CIDR</th>
             <th>Reserved IP Ranges</th>
             <th>DNS</th>
             <th>Gateway</th>
             <th>Availability Zones</th>
           </tr>
           <tr>
             <td>`pcf-services-subnet-az0`</td>
             <td>`10.0.8.0/24`</td>
             <td>`10.0.8.0-10.0.8.3`</td>
             <td>`169.254.169.253`</td>
             <td>`10.0.8.1`</td>
             <td>`REGION-#a` (for example, `us-west-2a`)</td>
           </tr>
           <tr>
             <td>`pcf-services-subnet-az1`</td>
             <td>`10.0.9.0/24`</td>
             <td>`10.0.9.0-10.0.9.3`</td>
             <td>`169.254.169.253`</td>
             <td>`10.0.9.1`</td>
             <td>`REGION-#b` (for example, `us-west-2b`)</td>
           </tr>
           <tr>
             <td>`pcf-services-subnet-az2`</td>
             <td>`10.0.10.0/24`</td>
             <td>`10.0.10.0-10.0.10.3`</td>
             <td>`169.254.169.253`</td>
             <td>`10.0.10.1`</td>
             <td>`REGION-#c` (for example, `us-west-2c`)</td>
           </tr>
           </table>
           <p><strong>\*</strong> If you set a VPC CIDR other than recommended, enter the second IP in your VPC CIDR. For example, for a <code>10.0.0.0/24</code> VPC CIDR, enter <code>10.0.0.2</code> in each subnet.</p>

1. Click **Save**.

## <a id="assign-azs"></a>Step 6: Assign AZs and Networks ##

1. Select **Assign AZs and Networks**.
<%= image_tag("images/assign-az.png") %>
1. Use the drop-down menu to select a **Singleton Availability Zone**. The Ops Manager Director is deployed into this AZ.
1. Use the drop-down menu to select `pcf-management-network` under **Network**. The Ops Manager Director is deployed into this network.
1. Click **Save**.

## <a id='security'></a>Step 7: Security Page ##

<%= partial "security-pane" %>

## <a id='syslog'></a>Step 8: Syslog Page

<%= partial 'syslog_bosh' %>

## <a id='pcfaws-om-rscestem'></a>Step 9: Resource Config Page ##

1. Select **Resource Config**.
    <%= image_tag("cloudform/resource-config-new.png") %>

1. Adjust any values as necessary for your deployment. Under the **Instances**, **Persistent Disk Type**, and **VM Type** fields,
choose **Automatic** from the drop-down menu to allocate the recommended resources for the job. If the **Persistent Disk Type** field reads **None**, the job does not require persistent disk space.

    <p class="note"><strong>Note</strong>: Pivotal recommends provisioning an Ops Manager Director VM with at least 8 GB memory.</p>

    <p class="note"><strong>Note</strong>: If you set a field to <strong>Automatic</strong> and the recommended resource allocation changes in a future version, Ops Manager automatically uses the new recommended allocation.</p>

1. Click **Save**.

## <a id='pcfaws-om-complete'></a>Step 10: Complete the Ops Manager Director Installation ##

1. Return to the **Installation Dashboard**.
1. Click **Apply Changes**. 
1. Ops Manager Director begins to install. The **Changes Applied** window displays when the installation process successfully completes.

    <%= image_tag("aws/vpc-step16.png") %>

1. Proceed to the [Deploying PAS on AWS](pcf-aws-manual-er-config.html) topic to continue deploying PCF.