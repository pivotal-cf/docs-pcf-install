---
title: Backing Up Pivotal Cloud Foundry&reg;
owner: RelEng
---

<strong><%= modified_date %></strong>

<% $this_topic = 'backup-pcf' %>

This topic describes the procedure for backing up each critical backend <%= vars.product_full %> component. Pivotal recommends frequently backing up your installation settings before making any changes to your PCF deployment, such as configuration of any tiles in Ops Manager.

To back up a deployment, export installation settings, download the BOSH Deployment Manifest, temporarily stop the Cloud Controller, create and export backup files for each critical backend component, and restart the Cloud Controller. It is also important to record your Cloud Controller Database encryption credentials which you will need if you contact Pivotal Support for help restoring your installation.

To restore your backup, see the [Restoring Pivotal Cloud Foundry&reg; from Backup](./restore-pcf.html) topic.

## <a id='encrypt-key'></a>Record the Cloud Controller Database Encryption Credentials ##

From the **Installation Dashboard**, select **Pivotal Elastic Runtime > Credentials** and locate the Cloud Controller section.
Record the Cloud Controller **DB Encryption Credentials**.
You must provide these credentials if you contact Pivotal Support for help
restoring your installation.

<%= image_tag("ccdb-encrypt-creds.png") %>

## <a id='export'></a>Export Installation Settings ##

Pivotal recommends that you back up your installation settings by exporting
frequently.
Always export an installation before following the steps in the [Import Installation Settings](./restore-pcf.html#import) section of the [Restoring Pivotal Cloud Foundry&reg; from Backup](./restore-pcf.html) topic.

<p class="note"><strong>Note</strong>: Exporting your installation only backs up your installation settings. It does not back up your virtual machines (VMs) or any external MySQL databases.</p>

From the **Installation Dashboard** in the Ops Manager interface, click the gear icon and select **Export installation settings**.
This option is only available after you have deployed at least one time.

**Export installation settings** exports the current PCF installation
settings and assets.
When you export an installation, the exported file contains the base VM images,
all necessary packages, and references to the installation IP addresses.
As a result, an exported installation file can exceed 5 GB in size.

<%= image_tag("action.png") %>

<p class='note'><strong>Note</strong>: For versions of Ops Manager 1.3 or older, the process of archiving files for export may exceed the timeout limit of 600 seconds and result in a <code>500</code> error. To resolve this issue, you can manually increase the timeout value, or assign additional resources to the Ops Manager VM to improve performance. For more information, see the <a href="https://support.pivotal.io/hc/en-us/articles/206113627">Pivotal Support Knowledge Base</a>.</p>

## <a id='manifest'></a>Download the BOSH Deployment Manifest ##
<%= partial 'download_bosh_manifest' %>

## <a id='backup-databases'></a>Back Up Critical Backend Components ##

Your Elastic Runtime deployment contains several critical data stores that must be present for a complete restore. This section describes the procedure for backing up the databases and the servers associated with your PCF installation.

You must back up each of the following:

* NFS Server
* Pivotal MySQL Server

<p class="note"><strong>Note</strong>: To follow the backup instructions below, your network must be configured to allow access to the BOSH Director virtual machine (VM) from your local machine. If you do not have local administrator access, use the <code>scp</code> command to copy the TAR file to the BOSH Director VM. For example:
<code> scp vcap@10.0.0.10:nfs.tar.gz \ </code>
and
<code>vcap@10.0.0.03:/nfs.tar.gz</code></p>


### <a id='stop-cc-2'></a>Stop Cloud Controller###
<%= partial './stopping_cc' %>


### <a id='nfs'></a>Back Up NFS Server ###

1. In the BOSH deployment manifest, `cf.yml`, locate the `nfs_server` component and record the address:

    ```
    nfs_server:
      address: 10.0.0.10
      network: 10.0.0.0/24
    syslog_aggregator:
      address:
      port:
    ```

1. From the **Installation Dashboard** in Ops Manager, select **Elastic Runtime** and click **Credentials>Link to Credential**. Record the NFS Server credentials.

    <%= image_tag("nfs-creds.png") %>

1. SSH into the NFS server VM and create a TAR file:
    <pre class='terminal'>
        $ ssh vcap@10.0.0.10 'cd /var/vcap/store && tar cz shared' > nfs.tar.gz
    </pre>
    <p class="note"><strong>Note</strong>: The TAR file that you create to back up NFS server might be large. To estimate the size of the TAR file before you create it, run the following command:
    <code class=''>ssh vcap@10.0.0.10 'tar -cf - /dir/to/archive/ | wc -c'</code></p>


### <a id='backup-mysql'></a>Back Up Pivotal MySQL Server ###

<p class="note"><strong>Note</strong>: The Elastic Runtime deploy contains an embedded MySQL Server that serves as the data store for the Cloud Controller, UAA, and Apps Manager and for Application Usage Events, Notifications, and Autoscaler services. </p>

There are two ways to backup the MySQL Server:

* [Automatic backup](#automatic-mysql) to a Amazon Web Services S3 bucket
* [Manual backup](#manual-mysql)

#### <a id='automatic-mysql'></a>Backing up MySQL Server Automatically ####

The embedded MySQL Server is able to automatically back up its data to an external blobstore periodically. This functionality can be configured in the "MySQL Config" tab in ERT:

<%= image_tag("mysql-backups-config.png") %>

For more details, refer to the [P-MySQL backups](/p-mysql/backup.html) topic.


#### <a id='manual-mysql'></a>Backing up MySQL Server Manually ####

1. From the Installation Dashboard in Ops Manager, select **Pivotal Elastic Runtime**. Click **Status** and record the IP address of the first instance of **MySQL Server**.
 
    <%= image_tag("mysql-ip.png") %>
 
1. Click **Credentials** and record the Mysql Admin Credentials of **MySQL Server**.

    <%= image_tag("mysql-cred.png") %>

1. SSH into the Mysql database VM as the admin using the IP address and password recorded in the previous steps.

1. Run the following command to dump the data from the p-mysql database and save it:
 <pre class='terminal'>
     $ mysqldump -u root -p -h 10.0.1.26 --all-databases > user_databases.sql
 </pre>
 
1. Run `scp` to copy the exported database to your local machine.
 <pre class='terminal'>
     $ scp vcap@10.0.1.26:~/user_databases.sql .
 </pre>

### <a id='cc-start'></a>Start Cloud Controller ###
<%= partial './starting_cc' %>

Follow the steps in the [Restoring Pivotal Cloud Foundry&reg; from Backup](./restore-pcf.html) topic to restore a backup, import an installation to restore your settings, or to share your settings with another user.

